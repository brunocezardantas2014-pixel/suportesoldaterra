<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Chamados Sol da Terra - PRO</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f9;
    margin:0;
}

header{
    background:#0f172a;
    color:white;
    text-align:center;
    padding:20px;
}

header img{ width:70px; }

.container{
    width:95%;
    margin:20px auto;
}

.painel{
    display:flex;
    gap:15px;
    margin-bottom:20px;
}

.card{
    flex:1;
    padding:15px;
    border-radius:8px;
    color:white;
    text-align:center;
    font-size:18px;
}

.aberto{ background:#dc2626; }
.andamento{ background:#f59e0b; }
.finalizado{ background:#16a34a; }

form{
    background:white;
    padding:15px;
    border-radius:8px;
    margin-bottom:20px;
}

input, select, textarea{
    padding:8px;
    margin:5px;
}

textarea{
    width:250px;
    height:40px;
}

button{
    padding:8px 15px;
    background:#0f172a;
    color:white;
    border:none;
    border-radius:5px;
    cursor:pointer;
}

table{
    width:100%;
    border-collapse:collapse;
    background:white;
}

th, td{
    border:1px solid #ddd;
    padding:8px;
    text-align:center;
}

th{
    background:#0f172a;
    color:white;
}
</style>
</head>

<body>

<header>
<img src="https://cdn-icons-png.flaticon.com/512/1055/1055687.png">
<h1>Chamados Sol da Terra</h1>
<p>Painel de Gestão - Suporte TI</p>
</header>

<div class="container">

<div class="painel">
    <div class="card aberto">Abertos<br><span id="cAbertos">0</span></div>
    <div class="card andamento">Em Andamento<br><span id="cAndamento">0</span></div>
    <div class="card finalizado">Finalizados<br><span id="cFinalizado">0</span></div>
</div>

<form onsubmit="adicionarChamado(); return false;">
<select id="departamento" required>
<option value="">Departamento</option>
<option>Administrativo</option>
<option>Fábrica</option>
<option>Lojas Matriz</option>
<option>Loja Campinas</option>
</select>

<input type="text" id="cliente" placeholder="Funcionário" required>
<textarea id="descricao" placeholder="Descrição" required></textarea>

<select id="status">
<option>Aberto</option>
<option>Em andamento</option>
<option>Finalizado</option>
</select>

<button type="submit">Abrir Chamado</button>
<button type="button" onclick="exportarExcel()">Exportar Excel</button>
</form>

<table>
<thead>
<tr>
<th>Departamento</th>
<th>Data</th>
<th>Funcionário</th>
<th>Descrição</th>
<th>Status</th>
<th>Ação</th>
</tr>
</thead>
<tbody id="tabelaChamados"></tbody>
</table>

<br><br>
<canvas id="graficoDept"></canvas>

</div>

<script>
let chamados = JSON.parse(localStorage.getItem("chamados")) || [];

function salvar(){
    localStorage.setItem("chamados", JSON.stringify(chamados));
}

function adicionarChamado(){
    let novo = {
        departamento: departamento.value,
        data: new Date().toLocaleString(),
        cliente: cliente.value,
        descricao: descricao.value,
        status: status.value
    };
    chamados.push(novo);
    salvar();
    atualizar();
    document.querySelector("form").reset();
}

function atualizar(){
    let tabela = document.getElementById("tabelaChamados");
    tabela.innerHTML="";

    let abertos=0, andamento=0, finalizados=0;
    let deptCount={};

    chamados.forEach((c,i)=>{
        let linha = tabela.insertRow();
        linha.insertCell(0).innerHTML=c.departamento;
        linha.insertCell(1).innerHTML=c.data;
        linha.insertCell(2).innerHTML=c.cliente;
        linha.insertCell(3).innerHTML=c.descricao;
        linha.insertCell(4).innerHTML=c.status;
        linha.insertCell(5).innerHTML=
            "<button onclick='finalizar("+i+")'>Finalizar</button>";

        if(c.status=="Aberto") abertos++;
        if(c.status=="Em andamento") andamento++;
        if(c.status=="Finalizado") finalizados++;

        deptCount[c.departamento]=(deptCount[c.departamento]||0)+1;
    });

    cAbertos.innerText=abertos;
    cAndamento.innerText=andamento;
    cFinalizado.innerText=finalizados;

    atualizarGrafico(deptCount);
}

function finalizar(i){
    chamados[i].status="Finalizado";
    salvar();
    atualizar();
}

let grafico;

function atualizarGrafico(deptCount){
    let ctx=document.getElementById('graficoDept').getContext('2d');

    if(grafico) grafico.destroy();

    grafico=new Chart(ctx,{
        type:'bar',
        data:{
            labels:Object.keys(deptCount),
            datasets:[{
                label:'Chamados por Departamento',
                data:Object.values(deptCount)
            }]
        }
    });
}

function exportarExcel(){
    let csv="Departamento,Data,Funcionario,Descricao,Status\n";
    chamados.forEach(c=>{
        csv+=`${c.departamento},${c.data},${c.cliente},${c.descricao},${c.status}\n`;
    });

    let blob=new Blob([csv],{type:"text/csv"});
    let link=document.createElement("a");
    link.href=URL.createObjectURL(blob);
    link.download="chamados.csv";
    link.click();
}

atualizar();
</script>

</body>
</html>